!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","prop-types"],r):r(e.ReactOauthFlow={},e.React,e.PropTypes)}(this,function(e,s,r){"use strict";r=r&&r.hasOwnProperty("default")?r.default:r;var f="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e,r){return e(r={exports:{}},r.exports),r.exports}var A=t(function(e,i){var a=Object.prototype.hasOwnProperty,c=function(){for(var e=[],r=0;r<256;++r)e.push("%"+((r<16?"0":"")+r.toString(16)).toUpperCase());return e}();i.arrayToObject=function(e,r){for(var t=r&&r.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(t[n]=e[n]);return t},i.merge=function(t,n,o){if(!n)return t;if("object"!=typeof n){if(Array.isArray(t))t.push(n);else{if("object"!=typeof t)return[t,n];(o.plainObjects||o.allowPrototypes||!a.call(Object.prototype,n))&&(t[n]=!0)}return t}if("object"!=typeof t)return[t].concat(n);var e=t;return Array.isArray(t)&&!Array.isArray(n)&&(e=i.arrayToObject(t,o)),Array.isArray(t)&&Array.isArray(n)?(n.forEach(function(e,r){a.call(t,r)?t[r]&&"object"==typeof t[r]?t[r]=i.merge(t[r],e,o):t.push(e):t[r]=e}),t):Object.keys(n).reduce(function(e,r){var t=n[r];return a.call(e,r)?e[r]=i.merge(e[r],t,o):e[r]=t,e},e)},i.assign=function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},i.decode=function(r){try{return decodeURIComponent(r.replace(/\+/g," "))}catch(e){return r}},i.encode=function(e){if(0===e.length)return e;for(var r="string"==typeof e?e:String(e),t="",n=0;n<r.length;++n){var o=r.charCodeAt(n);45===o||46===o||95===o||126===o||48<=o&&o<=57||65<=o&&o<=90||97<=o&&o<=122?t+=r.charAt(n):o<128?t+=c[o]:o<2048?t+=c[192|o>>6]+c[128|63&o]:o<55296||57344<=o?t+=c[224|o>>12]+c[128|o>>6&63]+c[128|63&o]:(n+=1,o=65536+((1023&o)<<10|1023&r.charCodeAt(n)),t+=c[240|o>>18]+c[128|o>>12&63]+c[128|o>>6&63]+c[128|63&o])}return t},i.compact=function(e){for(var r=[{obj:{o:e},prop:"o"}],t=[],n=0;n<r.length;++n)for(var o=r[n],i=o.obj[o.prop],a=Object.keys(i),c=0;c<a.length;++c){var l=a[c],u=i[l];"object"==typeof u&&null!==u&&-1===t.indexOf(u)&&(r.push({obj:i,prop:l}),t.push(u))}return function(e){for(var r;e.length;){var t=e.pop();if(r=t.obj[t.prop],Array.isArray(r)){for(var n=[],o=0;o<r.length;++o)void 0!==r[o]&&n.push(r[o]);t.obj[t.prop]=n}}return r}(r)},i.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},i.isBuffer=function(e){return null!=e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}}),n=(A.arrayToObject,A.merge,A.assign,A.decode,A.encode,A.compact,A.isRegExp,A.isBuffer,String.prototype.replace),o=/%20/g,x={default:"RFC3986",formatters:{RFC1738:function(e){return n.call(e,o,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"},P={brackets:function(e){return e+"[]"},indices:function(e,r){return e+"["+r+"]"},repeat:function(e){return e}},i=Date.prototype.toISOString,S={delimiter:"&",encode:!0,encoder:A.encode,encodeValuesOnly:!1,serializeDate:function(e){return i.call(e)},skipNulls:!1,strictNullHandling:!1},C=function e(r,t,n,o,i,a,c,l,u,s,p,f){var d=r;if("function"==typeof c)d=c(t,d);else if(d instanceof Date)d=s(d);else if(null===d){if(o)return a&&!f?a(t,S.encoder):t;d=""}if("string"==typeof d||"number"==typeof d||"boolean"==typeof d||A.isBuffer(d))return a?[p(f?t:a(t,S.encoder))+"="+p(a(d,S.encoder))]:[p(t)+"="+p(String(d))];var y,h=[];if(void 0===d)return h;if(Array.isArray(c))y=c;else{var g=Object.keys(d);y=l?g.sort(l):g}for(var b=0;b<y.length;++b){var v=y[b];i&&null===d[v]||(h=Array.isArray(d)?h.concat(e(d[v],n(t,v),n,o,i,a,c,l,u,s,p,f)):h.concat(e(d[v],t+(u?"."+v:"["+v+"]"),n,o,i,a,c,l,u,s,p,f)))}return h},d=Object.prototype.hasOwnProperty,y={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:A.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},u=function(e,r,t){if(e){var n=t.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,i=/(\[[^[\]]*])/.exec(n),a=i?n.slice(0,i.index):n,c=[];if(a){if(!t.plainObjects&&d.call(Object.prototype,a)&&!t.allowPrototypes)return;c.push(a)}for(var l=0;null!==(i=o.exec(n))&&l<t.depth;){if(l+=1,!t.plainObjects&&d.call(Object.prototype,i[1].slice(1,-1))&&!t.allowPrototypes)return;c.push(i[1])}return i&&c.push("["+n.slice(i.index)+"]"),function(e,r,t){for(var n=r,o=e.length-1;0<=o;--o){var i,a=e[o];if("[]"===a)i=(i=[]).concat(n);else{i=t.plainObjects?Object.create(null):{};var c="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,l=parseInt(c,10);!isNaN(l)&&a!==c&&String(l)===c&&0<=l&&t.parseArrays&&l<=t.arrayLimit?(i=[])[l]=n:i[c]=n}n=i}return n}(c,r,t)}},a={formats:x,parse:function(e,r){var t=r?A.assign({},r):{};if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(t.ignoreQueryPrefix=!0===t.ignoreQueryPrefix,t.delimiter="string"==typeof t.delimiter||A.isRegExp(t.delimiter)?t.delimiter:y.delimiter,t.depth="number"==typeof t.depth?t.depth:y.depth,t.arrayLimit="number"==typeof t.arrayLimit?t.arrayLimit:y.arrayLimit,t.parseArrays=!1!==t.parseArrays,t.decoder="function"==typeof t.decoder?t.decoder:y.decoder,t.allowDots="boolean"==typeof t.allowDots?t.allowDots:y.allowDots,t.plainObjects="boolean"==typeof t.plainObjects?t.plainObjects:y.plainObjects,t.allowPrototypes="boolean"==typeof t.allowPrototypes?t.allowPrototypes:y.allowPrototypes,t.parameterLimit="number"==typeof t.parameterLimit?t.parameterLimit:y.parameterLimit,t.strictNullHandling="boolean"==typeof t.strictNullHandling?t.strictNullHandling:y.strictNullHandling,""===e||null==e)return t.plainObjects?Object.create(null):{};for(var n="string"==typeof e?function(e,r){for(var t={},n=r.ignoreQueryPrefix?e.replace(/^\?/,""):e,o=r.parameterLimit===1/0?void 0:r.parameterLimit,i=n.split(r.delimiter,o),a=0;a<i.length;++a){var c,l,u=i[a],s=u.indexOf("]="),p=-1===s?u.indexOf("="):s+1;-1===p?(c=r.decoder(u,y.decoder),l=r.strictNullHandling?null:""):(c=r.decoder(u.slice(0,p),y.decoder),l=r.decoder(u.slice(p+1),y.decoder)),d.call(t,c)?t[c]=[].concat(t[c]).concat(l):t[c]=l}return t}(e,t):e,o=t.plainObjects?Object.create(null):{},i=Object.keys(n),a=0;a<i.length;++a){var c=i[a],l=u(c,n[c],t);o=A.merge(o,l,t)}return A.compact(o)},stringify:function(e,r){var t=e,n=r?A.assign({},r):{};if(null!==n.encoder&&void 0!==n.encoder&&"function"!=typeof n.encoder)throw new TypeError("Encoder has to be a function.");var o=void 0===n.delimiter?S.delimiter:n.delimiter,i="boolean"==typeof n.strictNullHandling?n.strictNullHandling:S.strictNullHandling,a="boolean"==typeof n.skipNulls?n.skipNulls:S.skipNulls,c="boolean"==typeof n.encode?n.encode:S.encode,l="function"==typeof n.encoder?n.encoder:S.encoder,u="function"==typeof n.sort?n.sort:null,s=void 0!==n.allowDots&&n.allowDots,p="function"==typeof n.serializeDate?n.serializeDate:S.serializeDate,f="boolean"==typeof n.encodeValuesOnly?n.encodeValuesOnly:S.encodeValuesOnly;if(void 0===n.format)n.format=x.default;else if(!Object.prototype.hasOwnProperty.call(x.formatters,n.format))throw new TypeError("Unknown format option provided.");var d,y,h=x.formatters[n.format];"function"==typeof n.filter?t=(y=n.filter)("",t):Array.isArray(n.filter)&&(d=y=n.filter);var g,b=[];if("object"!=typeof t||null===t)return"";g=n.arrayFormat in P?n.arrayFormat:"indices"in n?n.indices?"indices":"repeat":"indices";var v=P[g];d||(d=Object.keys(t)),u&&d.sort(u);for(var m=0;m<d.length;++m){var O=d[m];a&&null===t[O]||(b=b.concat(C(t[O],O,v,i,a,c?l:null,y,u,s,p,h,f)))}var j=b.join(o),w=!0===n.addQueryPrefix?"?":"";return 0<j.length?w+j:""}},h=t(function(l,p){!function(e){var r=p,t=l&&l.exports==r&&l,n="object"==typeof f&&f;n.global!==n&&n.window!==n||(e=n);var o=function(e){this.message=e};(o.prototype=new Error).name="InvalidCharacterError";var u=function(e){throw new o(e)},s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c=/[\t\n\f\r ]/g,i={encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&u("The string to be encoded contains characters outside of the Latin1 range.");for(var r,t,n,o,i=e.length%3,a="",c=-1,l=e.length-i;++c<l;)r=e.charCodeAt(c)<<16,t=e.charCodeAt(++c)<<8,n=e.charCodeAt(++c),a+=s.charAt((o=r+t+n)>>18&63)+s.charAt(o>>12&63)+s.charAt(o>>6&63)+s.charAt(63&o);return 2==i?(r=e.charCodeAt(c)<<8,t=e.charCodeAt(++c),a+=s.charAt((o=r+t)>>10)+s.charAt(o>>4&63)+s.charAt(o<<2&63)+"="):1==i&&(o=e.charCodeAt(c),a+=s.charAt(o>>2)+s.charAt(o<<4&63)+"=="),a},decode:function(e){var r=(e=String(e).replace(c,"")).length;r%4==0&&(r=(e=e.replace(/==?$/,"")).length),(r%4==1||/[^+a-zA-Z0-9/]/.test(e))&&u("Invalid character: the string to be decoded is not correctly encoded.");for(var t,n,o=0,i="",a=-1;++a<r;)n=s.indexOf(e.charAt(a)),t=o%4?64*t+n:n,o++%4&&(i+=String.fromCharCode(255&t>>(-2*o&6)));return i},version:"0.1.0"};if(r&&!r.nodeType)if(t)t.exports=i;else for(var a in i)i.hasOwnProperty(a)&&(r[a]=i[a]);else e.base64=i}(f)}),g=function(e,r,t){return Object.defineProperty(e,r,{enumerable:!1,configurable:!1,writable:!1,value:t}),e};function b(e,r,t){if(null==r)return e;var n=void 0;return(n=null!=t?t(r):a.stringify(r))?e+(e.indexOf("?")<0?"?":"&")+n:e}var c="react-oauth-flow",l=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},p=function(){function n(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,r,t){return r&&n(e.prototype,r),t&&n(e,t),e}}(),v=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},m=function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)},O=function(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r},j=function(e){function a(){var e,r,t;l(this,a);for(var n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];return r=t=O(this,(e=a.__proto__||Object.getPrototypeOf(a)).call.apply(e,[this].concat(o))),w.call(t),O(t,r)}return m(a,e),p(a,[{key:"componentDidMount",value:function(){this.getAuthorizationCode()}},{key:"render",value:function(){var e=this.props,r=e.component,t=e.render,n=e.children,o=this.state,i=o.processing,a=o.state,c=o.error;return null!=r?s.createElement(r,{processing:i,state:a,error:c}):null!=t?t({processing:i,state:a,error:c}):null!=n?(s.Children.only(n),n({processing:i,state:a,error:c})):null}}]),a}(s.Component);j.propTypes={tokenUrl:r.string.isRequired,clientId:r.string.isRequired,clientSecret:r.string.isRequired,redirectUri:r.string.isRequired,appName:r.string,args:r.objectOf(r.oneOfType([r.string,r.number,r.bool,r.object])),location:r.shape({search:r.string.isRequired}),querystring:r.string,onAuthSuccess:r.func,onAuthError:r.func,render:r.func,component:r.element,children:r.func},j.defaultProps={args:{},location:null,querystring:null,appName:c,onAuthSuccess:null,onAuthError:null,render:null,component:null,children:null};var w=function(){var d=this;this.state={processing:!0,state:null,error:null},this.getAuthorizationCode=function(){try{var e=d.props,r=e.tokenUrl,t=e.clientId,n=e.clientSecret,o=e.redirectUri,i=e.appName,a=e.args,c=e.onAuthSuccess,l=d.parseQuerystring(),u=l.error,s=l.error_description,p=l.code,f=JSON.parse(l.state);if(d.setState(function(){return{state:f}}),null!=u)throw new Error(s);(function(e,r){alert("url",e),alert("opts",r);var n=fetch(e,r);return alert("req",n),n.then(function(e){if(alert(e),!e.ok)throw e;return e.json()}).catch(function(t){if(!t.json)throw t;t.json().then(function(e){var r=new Error(t.statusText);throw g(r,"response",t),g(r.response,"data",e),g(r,"request",n),r})})})(b(""+r,v({code:p,grant_type:"authorization_code",client_id:t,client_secret:n,redirect_uri:o},a)),{method:"POST",headers:new Headers({"User-Agent":i,Authorization:"Basic "+h.encode(t+":"+n),"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"})}).then(function(e){var r=e.access_token;"function"==typeof c&&c(r,{response:e,state:f}),d.setState(function(){return{processing:!1}})}).catch(function(e){d.handleError(e),d.setState(function(){return{processing:!1}})})}catch(u){d.handleError(u),d.setState(function(){return{processing:!1}})}},this.handleError=function(e){var r=d.props.onAuthError;d.setState(function(){return{error:e}}),"function"==typeof r&&r(e)},this.parseQuerystring=function(){var e=d.props,r=e.location,t=e.querystring,n=void 0;return n=null!=r?r.search:null!=t?t:window.location.search,a.parse(n,{ignoreQueryPrefix:!0})}},E=function(e){function r(){return l(this,r),O(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return m(r,e),p(r,[{key:"render",value:function(){var e=this.props,r=e.authorizeUrl,t=e.clientId,n=e.redirectUri,o=e.state,i=e.args,a=e.render,c=e.component,l=e.children,u=b(""+r,v({client_id:t,redirect_uri:n,response_type:"code",state:o?JSON.stringify(o):void 0},i||{}));return null!=c?s.createElement(c,{url:u}):null!=a?a({url:u}):null!=l?(s.Children.only(l),l({url:u})):null}}]),r}(s.Component);E.propTypes={authorizeUrl:r.string.isRequired,clientId:r.string.isRequired,redirectUri:r.string.isRequired,state:r.objectOf(r.oneOfType([r.string,r.number,r.bool,r.object])),args:r.objectOf(r.oneOfType([r.string,r.number,r.bool,r.object])),render:r.func,component:r.element,children:r.func},E.defaultProps={state:null,args:null,render:null,component:null,children:null},e.createOauthFlow=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=e.authorizeUrl,t=e.tokenUrl,n=e.clientId,o=e.clientSecret,i=e.redirectUri,a=e.appName;return{Sender:function(e){return s.createElement(E,v({authorizeUrl:r,clientId:n,redirectUri:i},e))},Receiver:function(e){return s.createElement(j,v({tokenUrl:t,clientId:n,clientSecret:o,redirectUri:i,appName:a},e))}}},e.OauthSender=E,e.OauthReceiver=j,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=react-oauth-flow.umd.min.js.map
